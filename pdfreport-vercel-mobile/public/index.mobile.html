<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oneâ€‘Click PDF Report Generator</title>
    <style>
      /* Base styles */
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica,
          Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
        /* Remove the fallback gradient so the video is visible.
           Use a subtle neutral background as a fallback in case the video fails to load. */
        background-color: #f6f7fb;
        color: #1c1c1e;
        position: relative;
      }

      /* Add blurred decorative shapes inspired by ClickUp/Wozber */
      body::before,
      body::after {
        content: '';
        position: fixed;
        width: 450px;
        height: 450px;
        border-radius: 50%;
        filter: blur(140px);
        opacity: 0.4;
        pointer-events: none;
        z-index: -1;
      }
      body::before {
        top: 10%;
        left: -15%;
        background: radial-gradient(circle at 30% 30%, #9fb8ff 0%, #b18fff 100%);
      }
      body::after {
        bottom: -10%;
        right: -15%;
        background: radial-gradient(circle at 70% 70%, #f7b5d7 0%, #d58eed 100%);
      }

      /* Video background styles */
      #backgroundVideo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
      }

      /* Overlay for better contrast on top of video */
      #videoOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.25);
        z-index: -1;
      }
      header {
        width: 100%;
        /* Make the header translucent so the background video shows through */
        background-color: transparent;
        color: #2d2d2d;
        padding: 0.8rem 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        /* Remove backdrop filter and shadow for a cleaner transparent look */
        backdrop-filter: none;
        box-shadow: none;
      }

      /* Style the logo image */
      header .logo {
        /* Increase logo size for better prominence */
        height: 100px;
        width: auto;
      }
      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 2rem 1rem;
        position: relative;
        z-index: 1;
      }
      .form-card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 24px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 680px;
        padding: 3.5rem 3rem;
        margin-top: 0;
        border: 1px solid rgba(255, 255, 255, 0.6);
        backdrop-filter: saturate(180%) blur(20px);
      }
      .step-indicators {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        position: relative;
      }
      /* Progress bar behind step circles */
      .progress-bar {
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        height: 6px;
        background-color: rgba(255, 255, 255, 0.4);
        border-radius: 3px;
        transform: translateY(-50%);
      }
      .progress-bar-fill {
        height: 100%;
        width: 0;
        background-image: linear-gradient(90deg, #5a6dfb 0%, #c76fe2 100%);
        border-radius: 3px;
        transition: width 0.3s ease;
      }
      .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        color: #333;
        font-weight: 600;
        background-color: rgba(255, 255, 255, 0.85);
        transition: background-color 0.3s, color 0.3s, border 0.3s, transform 0.3s;
        transform: scale(1);
      }
      .step-circle.active {
        background-image: linear-gradient(135deg, #5a6dfb 0%, #c76fe2 100%);
        border-color: transparent;
        color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: scale(1.2);
        font-size: 16px;
      }
      .step-circle.completed {
        background-image: linear-gradient(135deg, #5a6dfb 0%, #c76fe2 100%);
        border-color: transparent;
        color: #ffffff;
        font-size: 20px;
      }
      .form-step {
        display: none;
        opacity: 0;
        transform: translateX(30px);
        transition: opacity 0.4s ease, transform 0.4s ease;
      }
      .form-step.active {
        display: block;
        opacity: 1;
        transform: translateX(0);
      }
      label {
        display: block;
        margin-bottom: 0.6rem;
        font-weight: 600;
        color: #2d2d2d;
      }
      select,
      input[type='text'],
      input[type='date'] {
        width: 100%;
        padding: 0.8rem 1rem;
        font-size: 1rem;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        background-color: rgba(255, 255, 255, 0.8);
        color: #2d2d2d;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
        backdrop-filter: saturate(180%) blur(15px);
      }
      select:focus,
      input[type='text']:focus,
      input[type='date']:focus {
        border-color: #5a6dfb;
        box-shadow: 0 0 0 3px rgba(90, 109, 251, 0.25);
      }
      .button-row {
        display: flex;
        justify-content: space-between;
        gap: 0.5rem;
        margin-top: 2rem;
      }
      .btn {
        flex: 1;
        padding: 0.9rem 1.4rem;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      }
      .btn-primary {
        background-image: linear-gradient(135deg, #5a6dfb 0%, #c76fe2 100%);
        color: #ffffff;
      }
      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 12px rgba(90, 109, 251, 0.4);
      }
      .btn-secondary {
        background-color: rgba(255, 255, 255, 0.7);
        color: #2d2d2d;
      }
      .btn-secondary:hover {
        background-color: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .status {
        margin-top: 1rem;
        font-size: 0.95rem;
        min-height: 1.4rem;
        color: #2d2d2d;
        text-align: center;
        font-weight: 500;
      }
      .status.error {
        color: #e74c3c;
      }
      .status.success {
        color: #27ae60;
      }

      /* Responsive styling for smaller screens */
      @media (max-width: 600px) {
        /* Limit the form card size and allow scrolling inside it */
        .form-card {
          max-width: 90%;
          max-height: 60vh;
          padding: 1.5rem 1rem;
          margin: 1.5rem auto;
          overflow-y: auto;
        }
        /* Scale down the step indicator circles */
        .step-circle {
          width: 28px;
          height: 28px;
          font-size: 12px;
        }
        /* Make the active circle slightly larger */
        .step-circle.active {
          width: 32px;
          height: 32px;
          font-size: 13px;
          transform: scale(1.1);
        }
        /* Stack the navigation buttons vertically */
        .button-row {
          flex-direction: column;
        }
        .button-row .btn {
          font-size: 14px;
          padding: 0.75rem;
          width: 100%;
          margin-bottom: 0.5rem;
        }
        /* Reduce the logo size on mobile */
        header .logo {
          height: 48px;
        }
      }

      /* Style the summary preview on the final step */
      #summaryText {
        white-space: pre-line;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 1rem 1.2rem;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        color: #2d2d2d;
        font-size: 0.95rem;
        line-height: 1.5;
        backdrop-filter: saturate(180%) blur(10px);
      }
    </style>
  </head>
  <body>
    <!-- Video background inserted based on user-provided pastel gradient -->
    <video id="backgroundVideo" autoplay loop muted playsinline>
      <source src="background.mp4" type="video/mp4" />
    </video>
    <div id="videoOverlay"></div>
    <header>
      <!-- Insert the provided logo image instead of the plain text title -->
      <img src="logo.png" alt="PDF generator logo" class="logo" />
    </header>
    <main>
      <div class="form-card">
        <div class="step-indicators">
          <div class="progress-bar"><div class="progress-bar-fill" id="progressFill"></div></div>
          <div class="step-circle active">1</div>
          <div class="step-circle">2</div>
          <div class="step-circle">3</div>
          <div class="step-circle">4</div>
          <div class="step-circle">5</div>
        </div>
        <!-- Step 1: Platform selection -->
        <div id="step1" class="form-step active">
          <label for="platformSelect">Select platform</label>
          <select id="platformSelect">
            <option value="">-- Choose --</option>
            <option value="instagram">Instagram</option>
            <option value="tiktok">TikTok</option>
          </select>
          <div class="button-row">
            <button class="btn btn-primary" id="next1" disabled>Next</button>
          </div>
        </div>
        <!-- Step 2: Profile URL -->
        <div id="step2" class="form-step">
          <label for="profileUrl">Enter profile URL</label>
          <input
            type="text"
            id="profileUrl"
            placeholder="https://instagram.com/username"
          />
          <div class="button-row">
            <button class="btn btn-secondary" id="back2">Back</button>
            <button class="btn btn-primary" id="next2" disabled>Next</button>
          </div>
        </div>
        <!-- Step 3: Start date -->
        <div id="step3" class="form-step">
          <label for="sinceDate">Choose start date</label>
          <input type="date" id="sinceDate" />
          <div class="button-row">
            <button class="btn btn-secondary" id="back3">Back</button>
            <button class="btn btn-primary" id="next3">Next</button>
          </div>
        </div>
        <!-- Step 4: End date -->
        <div id="step4" class="form-step">
          <label for="untilDate">Choose end date</label>
          <input type="date" id="untilDate" />
          <div class="button-row">
            <button class="btn btn-secondary" id="back4">Back</button>
            <button class="btn btn-primary" id="next4">Next</button>
          </div>
        </div>
        <!-- Step 5: Summary & Generate -->
        <div id="step5" class="form-step">
          <p id="summaryText" style="margin-bottom: 1rem;"></p>
          <div class="button-row">
            <button class="btn btn-secondary" id="back5">Back</button>
            <button class="btn btn-primary" id="generateBtn">Generate Report</button>
          </div>
        </div>
      </div>
      <div id="status" class="status"></div>
    </main>
    <script>
      // Multiâ€‘step form logic
      let currentStep = 1;
      const totalSteps = 5;

      const stepElements = [
        document.getElementById('step1'),
        document.getElementById('step2'),
        document.getElementById('step3'),
        document.getElementById('step4'),
        document.getElementById('step5'),
      ];
      const circleElements = document.querySelectorAll('.step-circle');
      const statusDiv = document.getElementById('status');
      const summaryText = document.getElementById('summaryText');

      // Input elements
      const platformSelect = document.getElementById('platformSelect');
      const profileUrlInput = document.getElementById('profileUrl');
      const sinceDateInput = document.getElementById('sinceDate');
      const untilDateInput = document.getElementById('untilDate');

      // Buttons
      const next1 = document.getElementById('next1');
      const back2 = document.getElementById('back2');
      const next2 = document.getElementById('next2');
      const back3 = document.getElementById('back3');
      const next3 = document.getElementById('next3');
      const back4 = document.getElementById('back4');
      const next4 = document.getElementById('next4');
      const back5 = document.getElementById('back5');
      const generateBtn = document.getElementById('generateBtn');

      function showStep(step) {
        currentStep = step;
        // Toggle step visibility and active class
        stepElements.forEach((el, idx) => {
          if (idx === step - 1) {
            el.classList.add('active');
            el.style.display = 'block';
          } else {
            el.classList.remove('active');
            el.style.display = 'none';
          }
        });
        // Update step indicator circles and progress bar
        circleElements.forEach((el, idx) => {
          if (idx < step - 1) {
            el.classList.add('completed');
            el.classList.remove('active');
            // Show checkmark for completed steps
            el.textContent = 'âœ“';
          } else if (idx === step - 1) {
            el.classList.add('active');
            el.classList.remove('completed');
            // Show the current step number
            el.textContent = String(idx + 1);
          } else {
            el.classList.remove('active');
            el.classList.remove('completed');
            // Show the default step number
            el.textContent = String(idx + 1);
          }
        });
        const progressFill = document.getElementById('progressFill');
        if (progressFill) {
          progressFill.style.width = ((step - 1) / (totalSteps - 1)) * 100 + '%';
        }
        statusDiv.textContent = '';
      }

      // Enable Next buttons based on input validity
      platformSelect.addEventListener('change', () => {
        next1.disabled = !platformSelect.value;
        // Update profile URL placeholder based on selected platform
        if (platformSelect.value === 'instagram') {
          profileUrlInput.placeholder = 'https://instagram.com/username';
        } else if (platformSelect.value === 'tiktok') {
          profileUrlInput.placeholder = 'https://tiktok.com/username';
        } else {
          profileUrlInput.placeholder = '';
        }
      });
      profileUrlInput.addEventListener('input', () => {
        next2.disabled = !profileUrlInput.value.trim();
      });
      // Step navigation
      next1.addEventListener('click', () => showStep(2));
      back2.addEventListener('click', () => showStep(1));
      next2.addEventListener('click', () => showStep(3));
      back3.addEventListener('click', () => showStep(2));
      next3.addEventListener('click', () => showStep(4));
      back4.addEventListener('click', () => showStep(3));
      next4.addEventListener('click', () => {
        // Populate summary before showing final step
        const since = sinceDateInput.value;
        const until = untilDateInput.value;
        const platform = platformSelect.value;
        const url = profileUrlInput.value.trim();
        let summary = `Platform: ${platform || 'N/A'}\n`;
        summary += `Profile: ${url || 'N/A'}\n`;
        summary += `From: ${since || 'N/A'}\n`;
        summary += `To: ${until || 'N/A'}`;
        summaryText.textContent = summary;
        showStep(5);
      });
      back5.addEventListener('click', () => showStep(4));

      // Generate report
      generateBtn.addEventListener('click', async () => {
        const since = sinceDateInput.value;
        const until = untilDateInput.value;
        const platform = platformSelect.value;
        const profileUrl = profileUrlInput.value.trim();
        statusDiv.textContent = 'Generating reportâ€¦';
        statusDiv.classList.remove('error', 'success');
        try {
          const response = await fetch('/api/report', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              since: since || undefined,
              until: until || undefined,
              platform: platform || undefined,
              profileUrl: profileUrl || undefined,
            }),
          });
          if (!response.ok) {
            throw new Error('Failed to generate report');
          }
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'report.pdf';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          statusDiv.textContent = 'Report downloaded successfully.';
          statusDiv.classList.add('success');
        } catch (err) {
          console.error(err);
          statusDiv.textContent = 'Error: ' + err.message;
          statusDiv.classList.add('error');
        }
      });
    </script>
  </body>
</html>